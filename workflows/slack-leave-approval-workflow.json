{
  "name": "ì—°ì°¨ ìŠ¹ì¸ â†’ Slack ì•Œë¦¼",
  "nodes": [
    {
      "parameters": {
        "pollTimes": {
          "item": [
            { "mode": "everyMinute" }
          ]
        },
        "simple": false
      },
      "id": "email-trigger",
      "name": "ì´ë©”ì¼ ìˆ˜ì‹  ê°ì§€",
      "type": "n8n-nodes-base.emailReadImap",
      "typeVersion": 2,
      "position": [200, 300]
    },
    {
      "parameters": {
        "jsCode": "// ì—°ì°¨ ìŠ¹ì¸ ë©”ì¼ ë³¸ë¬¸ì—ì„œ ì •ë³´ ì¶”ì¶œ\n// HR ì‹œìŠ¤í…œì— ë”°ë¼ ì •ê·œì‹ íŒ¨í„´ ì¡°ì • í•„ìš”\nconst items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const subject = item.json.subject || '';\n  const text = item.json.text || item.json.html || '';\n  const from = item.json.from?.text || item.json.from || '';\n\n  // ìŠ¹ì¸ ê´€ë ¨ í‚¤ì›Œë“œ í™•ì¸\n  const isApproval = /ìŠ¹ì¸|approved|í—ˆê°€|ì™„ë£Œ/.test(subject + text);\n  const isLeave = /ì—°ì°¨|íœ´ê°€|ë°˜ì°¨|ë³‘ê°€|leave|vacation|PTO/.test(subject + text);\n\n  if (!isApproval || !isLeave) continue;\n\n  // ì´ë¦„ ì¶”ì¶œ (íŒ¨í„´: \"í™ê¸¸ë™ë‹˜\", \"í™ê¸¸ë™ ë‹˜\", \"Name: í™ê¸¸ë™\")\n  const nameMatch = text.match(/([ê°€-í£]{2,4})\\s*ë‹˜/) ||\n                    text.match(/Name[:\\s]+([ê°€-í£a-zA-Z\\s]+)/) ||\n                    text.match(/ì‹ ì²­ì[:\\s]+([ê°€-í£]{2,4})/);\n  const name = nameMatch ? nameMatch[1].trim() : 'ì•Œ ìˆ˜ ì—†ìŒ';\n\n  // ê¸°ê°„ ì¶”ì¶œ (íŒ¨í„´: \"2026-02-05 ~ 2026-02-06\", \"2026.02.05 - 2026.02.06\")\n  const dateMatch = text.match(/(\\d{4}[-.\\/]\\d{1,2}[-.\\/]\\d{1,2})\\s*[~\\-â€“]\\s*(\\d{4}[-.\\/]\\d{1,2}[-.\\/]\\d{1,2})/) ||\n                    text.match(/(\\d{4}[-.\\/]\\d{1,2}[-.\\/]\\d{1,2})/);\n  const startDate = dateMatch ? dateMatch[1] : '';\n  const endDate = dateMatch && dateMatch[2] ? dateMatch[2] : startDate;\n\n  // ì¢…ë¥˜ ì¶”ì¶œ\n  let leaveType = 'ì—°ì°¨';\n  if (/ë°˜ì°¨|half/.test(text)) leaveType = 'ë°˜ì°¨';\n  else if (/ë³‘ê°€|sick/.test(text)) leaveType = 'ë³‘ê°€';\n  else if (/ê²½ì¡°|family/.test(text)) leaveType = 'ê²½ì¡°íœ´ê°€';\n  else if (/íŠ¹ë³„|special/.test(text)) leaveType = 'íŠ¹ë³„íœ´ê°€';\n\n  results.push({\n    json: {\n      name,\n      startDate,\n      endDate,\n      leaveType,\n      subject,\n      from,\n      isApproval: true\n    }\n  });\n}\n\nif (results.length === 0) {\n  results.push({ json: { isApproval: false } });\n}\n\nreturn results;"
      },
      "id": "parse-email",
      "name": "ë©”ì¼ íŒŒì‹±",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": false },
          "conditions": [
            {
              "id": "is-approval",
              "leftValue": "={{ $json.isApproval }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "if-approval",
      "name": "ìŠ¹ì¸ ë©”ì¼?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [700, 300]
    },
    {
      "parameters": {
        "jsCode": "const item = $input.first().json;\nconst today = new Date().toISOString().split('T')[0];\n\nconst period = item.startDate === item.endDate\n  ? item.startDate\n  : `${item.startDate} ~ ${item.endDate}`;\n\nconst blocks = [\n  {\n    type: 'header',\n    text: {\n      type: 'plain_text',\n      text: 'ğŸ“‹ ì—°ì°¨ ìŠ¹ì¸ ì•Œë¦¼'\n    }\n  },\n  {\n    type: 'section',\n    fields: [\n      { type: 'mrkdwn', text: `*ì´ë¦„:*\\n${item.name}` },\n      { type: 'mrkdwn', text: `*ì¢…ë¥˜:*\\n${item.leaveType}` },\n      { type: 'mrkdwn', text: `*ê¸°ê°„:*\\n${period}` },\n      { type: 'mrkdwn', text: '*ìƒíƒœ:*\\nâœ… ìŠ¹ì¸' }\n    ]\n  },\n  { type: 'divider' },\n  {\n    type: 'context',\n    elements: [{\n      type: 'mrkdwn',\n      text: `ğŸ“® ì•Œë¦¼ ì‹œê°: ${today} | n8n ìë™í™”`\n    }]\n  }\n];\n\nreturn [{\n  json: {\n    blocks: JSON.stringify(blocks),\n    text: `ğŸ“‹ ì—°ì°¨ ìŠ¹ì¸: ${item.name}ë‹˜ ${item.leaveType} (${period})`\n  }\n}];"
      },
      "id": "slack-format",
      "name": "Slack í¬ë§· ìƒì„±",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [950, 200]
    },
    {
      "parameters": {
        "operation": "post",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "auto-hr",
          "mode": "name"
        },
        "text": "={{ $json.text }}",
        "otherOptions": {
          "includeLinkToWorkflow": false,
          "blocksUi": "={{ $json.blocks }}"
        }
      },
      "id": "slack-send",
      "name": "Slack HR ì•Œë¦¼",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.2,
      "position": [1200, 200]
    }
  ],
  "connections": {
    "ì´ë©”ì¼ ìˆ˜ì‹  ê°ì§€": {
      "main": [[{ "node": "ë©”ì¼ íŒŒì‹±", "type": "main", "index": 0 }]]
    },
    "ë©”ì¼ íŒŒì‹±": {
      "main": [[{ "node": "ìŠ¹ì¸ ë©”ì¼?", "type": "main", "index": 0 }]]
    },
    "ìŠ¹ì¸ ë©”ì¼?": {
      "main": [
        [{ "node": "Slack í¬ë§· ìƒì„±", "type": "main", "index": 0 }],
        []
      ]
    },
    "Slack í¬ë§· ìƒì„±": {
      "main": [[{ "node": "Slack HR ì•Œë¦¼", "type": "main", "index": 0 }]]
    }
  },
  "settings": { "executionOrder": "v1", "timezone": "Asia/Seoul" }
}
