{
  "name": "Daily News Clipping (Perplexity + Slack)",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [{ "field": "cronExpression", "expression": "0 9 * * *" }]
        }
      },
      "id": "schedule-trigger",
      "name": "ë§¤ì¼ ì•„ì¹¨ 9ì‹œ",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [0, 300]
    },
    {
      "parameters": {
        "jsCode": "const today = new Date().toISOString().split('T')[0];\nreturn [\n  { json: { category: 'AI', categoryKr: 'AI í™œìš© íŒ', query: 'AI tools practical tips news 2026', dbId: '241003c7-f7be-806c-8a6e-c0e95ed37fe3', date: today } },\n  { json: { category: 'Design', categoryKr: 'UI/UX ë””ìì¸', query: 'UI UX design trends tips 2026', dbId: '241003c7-f7be-804f-a021-fc24777ca9ad', date: today } },\n  { json: { category: 'Branding', categoryKr: 'ë¸Œëœë”© ì „ëµ', query: 'branding strategy tips 2026', dbId: '247003c7-f7be-803a-83f5-fd9494d24d62', date: today } },\n  { json: { category: 'Build', categoryKr: 'ì›¹ê°œë°œ ì½”ë”©', query: 'web development coding tips 2026', dbId: '247003c7-f7be-8074-a583-e1638fd3cfed', date: today } },\n  { json: { category: 'Marketing', categoryKr: 'ë§ˆì¼€íŒ… ì „ëµ', query: 'marketing growth strategy 2026', dbId: '247003c7-f7be-8035-83f4-d39480d66503', date: today } }\n];"
      },
      "id": "set-categories",
      "name": "ì¹´í…Œê³ ë¦¬ ì •ì˜",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [220, 300]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "loop-categories",
      "name": "ì¹´í…Œê³ ë¦¬ Loop",
      "type": "n8n-nodes-base.loopOverItems",
      "typeVersion": 1,
      "position": [440, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.perplexity.ai/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"sonar\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"You are a professional news researcher. Return exactly 5 items as a valid JSON array with fields: title (string), url (string), source (string), summary (string - 1-2 sentences in Korean). Return ONLY the JSON array, no other text.\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"Find the latest 5 news about: {{ $json.query }}\"\n    }\n  ],\n  \"max_tokens\": 2000,\n  \"temperature\": 0.2,\n  \"return_citations\": true\n}",
        "options": {}
      },
      "id": "perplexity-search",
      "name": "Perplexity ê²€ìƒ‰",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [660, 300],
      "credentials": {
        "httpHeaderAuth": {
          "id": "NcEOsIRwIqlaElTb",
          "name": "Header Auth account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json;\nconst category = $('ì¹´í…Œê³ ë¦¬ Loop').first().json;\n\nlet content = '';\ntry {\n  content = input.choices?.[0]?.message?.content || '';\n} catch (e) {\n  content = '';\n}\n\nlet results = [];\ntry {\n  const jsonMatch = content.match(/\\[\\s*\\{[\\s\\S]*\\}\\s*\\]/g);\n  if (jsonMatch) {\n    results = JSON.parse(jsonMatch[0]);\n  } else {\n    const citations = input.citations || [];\n    results = citations.slice(0, 5).map((url, i) => ({\n      title: `${category.category} News ${i + 1}`,\n      url: url,\n      source: new URL(url).hostname,\n      summary: 'ë‰´ìŠ¤ ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”.'\n    }));\n  }\n} catch (e) {\n  const citations = input.citations || [];\n  results = citations.slice(0, 5).map((url, i) => ({\n    title: `${category.category} News ${i + 1}`,\n    url: url,\n    source: new URL(url).hostname,\n    summary: 'ë‰´ìŠ¤ ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”.'\n  }));\n}\n\nreturn results.slice(0, 5).map(item => ({\n  json: {\n    title: item.title || 'No Title',\n    url: item.url || '',\n    source: item.source || '',\n    summary: item.summary || '',\n    date: category.date,\n    category: category.category,\n    categoryKr: category.categoryKr,\n    dbId: category.dbId\n  }\n}));"
      },
      "id": "parse-perplexity",
      "name": "ê²°ê³¼ íŒŒì‹±",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [880, 300]
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "create",
        "databaseId": { "__rl": true, "mode": "id", "value": "={{ $json.dbId }}" },
        "title": "={{ $json.title }}",
        "propertiesUi": {
          "propertyValues": [
            { "key": "URL", "urlValue": "={{ $json.url }}" },
            { "key": "Summary", "richTextValue": "={{ $json.summary }}" }
          ]
        },
        "options": {}
      },
      "id": "notion-save",
      "name": "Notion ì €ì¥",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [1100, 300],
      "credentials": {
        "notionApi": {
          "id": "xw5kbbLStDNvEvBq",
          "name": "Notion account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const today = new Date().toISOString().split('T')[0];\nconst categories = [\n  { name: 'AI í™œìš© íŒ', query: 'AI tools practical tips' },\n  { name: 'UI/UX ë””ìì¸', query: 'UI UX design trends' },\n  { name: 'ë¸Œëœë”© ì „ëµ', query: 'branding strategy tips' },\n  { name: 'ì›¹ê°œë°œ ì½”ë”©', query: 'web development coding tips' },\n  { name: 'ë§ˆì¼€íŒ… ì „ëµ', query: 'marketing growth strategy' }\n];\n\nconst blocks = [\n  { type: 'header', text: { type: 'plain_text', text: `ğŸ“° Daily News Clipping - ${today}` } },\n  { type: 'section', text: { type: 'mrkdwn', text: `5ê°œ ì¹´í…Œê³ ë¦¬ Ã— 5ê°œ = *25ê°œ ë‰´ìŠ¤*ê°€ Notionì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.\\nğŸ¤– Powered by Perplexity AI` } },\n  { type: 'divider' }\n];\n\nfor (const cat of categories) {\n  blocks.push({ type: 'section', text: { type: 'mrkdwn', text: `*${cat.name}*\\nê²€ìƒ‰ì–´: \\`${cat.query}\\`` } });\n}\n\nblocks.push(\n  { type: 'divider' },\n  { type: 'context', elements: [{ type: 'mrkdwn', text: 'ğŸ”— <https://notion.so|Notionì—ì„œ í™•ì¸í•˜ê¸°> | n8n ìë™í™”' }] }\n);\n\nreturn [{ json: { blocks: JSON.stringify(blocks), text: `ğŸ“° Daily News Clipping - ${today} (25ê°œ ì €ì¥ ì™„ë£Œ)` } }];"
      },
      "id": "slack-format",
      "name": "Slack í¬ë§· ìƒì„±",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1540, 100]
    },
    {
      "parameters": {
        "operation": "post",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "auto-news",
          "mode": "name"
        },
        "text": "={{ $json.text }}",
        "otherOptions": {
          "includeLinkToWorkflow": false,
          "blocksUi": "={{ $json.blocks }}"
        }
      },
      "id": "slack-send",
      "name": "Slack ë‰´ìŠ¤ ì•Œë¦¼",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.2,
      "position": [1760, 100],
      "onError": "continueRegularOutput"
    }
  ],
  "connections": {
    "ë§¤ì¼ ì•„ì¹¨ 9ì‹œ": { "main": [[{ "node": "ì¹´í…Œê³ ë¦¬ ì •ì˜", "type": "main", "index": 0 }]] },
    "ì¹´í…Œê³ ë¦¬ ì •ì˜": { "main": [[{ "node": "ì¹´í…Œê³ ë¦¬ Loop", "type": "main", "index": 0 }]] },
    "ì¹´í…Œê³ ë¦¬ Loop": { "main": [
      [{ "node": "Perplexity ê²€ìƒ‰", "type": "main", "index": 0 }],
      [{ "node": "Slack í¬ë§· ìƒì„±", "type": "main", "index": 0 }]
    ] },
    "Perplexity ê²€ìƒ‰": { "main": [[{ "node": "ê²°ê³¼ íŒŒì‹±", "type": "main", "index": 0 }]] },
    "ê²°ê³¼ íŒŒì‹±": { "main": [[{ "node": "Notion ì €ì¥", "type": "main", "index": 0 }]] },
    "Notion ì €ì¥": { "main": [[{ "node": "ì¹´í…Œê³ ë¦¬ Loop", "type": "main", "index": 0 }]] },
    "Slack í¬ë§· ìƒì„±": { "main": [[{ "node": "Slack ë‰´ìŠ¤ ì•Œë¦¼", "type": "main", "index": 0 }]] }
  },
  "settings": {
    "executionOrder": "v1",
    "timezone": "Asia/Seoul",
    "saveExecutionProgress": true,
    "saveDataSuccessExecution": "all"
  }
}
