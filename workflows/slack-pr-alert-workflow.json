{
  "name": "GitHub PR â†’ Slack ì•Œë¦¼",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "github-pr-webhook",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "GitHub Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [200, 300],
      "webhookId": "github-pr-webhook"
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": false },
          "conditions": [
            {
              "id": "is-pr-event",
              "leftValue": "={{ $json.body.action }}",
              "rightValue": "opened,synchronize,review_requested,closed",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "has-pr",
              "leftValue": "={{ $json.body.pull_request }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "exists"
              }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "if-pr-event",
      "name": "PR ì´ë²¤íŠ¸?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "jsCode": "const body = $input.first().json.body;\nconst pr = body.pull_request;\nconst action = body.action;\n\n// ì•¡ì…˜ë³„ ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸\nconst actionMap = {\n  opened: { icon: 'ğŸ†•', text: 'ìƒˆ PR ìƒì„±' },\n  synchronize: { icon: 'ğŸ”„', text: 'PR ì—…ë°ì´íŠ¸' },\n  review_requested: { icon: 'ğŸ‘€', text: 'PR ë¦¬ë·° ìš”ì²­' },\n  closed: pr.merged ? { icon: 'âœ…', text: 'PR ë¨¸ì§€ ì™„ë£Œ' } : { icon: 'âŒ', text: 'PR ë‹«í˜' }\n};\n\nconst actionInfo = actionMap[action] || { icon: 'ğŸ”€', text: `PR ${action}` };\n\n// ë¦¬ë·°ì–´ ëª©ë¡\nconst reviewers = (body.requested_reviewers || pr.requested_reviewers || [])\n  .map(r => `@${r.login}`)\n  .join(', ') || 'ì—†ìŒ';\n\n// ë³€ê²½ íŒŒì¼ ìˆ˜\nconst changes = pr.changed_files ? `${pr.changed_files}ê°œ íŒŒì¼ (+${pr.additions}/-${pr.deletions})` : '';\n\nconst blocks = [\n  {\n    type: 'header',\n    text: { type: 'plain_text', text: `${actionInfo.icon} ${actionInfo.text}` }\n  },\n  {\n    type: 'section',\n    text: {\n      type: 'mrkdwn',\n      text: `*<${pr.html_url}|#${pr.number} ${pr.title}>*`\n    }\n  },\n  {\n    type: 'section',\n    fields: [\n      { type: 'mrkdwn', text: `*ì‘ì„±ì:*\\n<${pr.user.html_url}|@${pr.user.login}>` },\n      { type: 'mrkdwn', text: `*ë¦¬ë·°ì–´:*\\n${reviewers}` },\n      { type: 'mrkdwn', text: `*ë¸Œëœì¹˜:*\\n\\`${pr.head.ref}\\` â†’ \\`${pr.base.ref}\\`` },\n      { type: 'mrkdwn', text: `*ë³€ê²½:*\\n${changes}` }\n    ]\n  }\n];\n\n// PR ì„¤ëª…ì´ ìˆìœ¼ë©´ ì¶”ê°€ (ìµœëŒ€ 200ì)\nif (pr.body && pr.body.trim()) {\n  const desc = pr.body.length > 200 ? pr.body.substring(0, 200) + '...' : pr.body;\n  blocks.push({\n    type: 'section',\n    text: { type: 'mrkdwn', text: `*ì„¤ëª…:*\\n${desc}` }\n  });\n}\n\nblocks.push(\n  { type: 'divider' },\n  {\n    type: 'actions',\n    elements: [\n      {\n        type: 'button',\n        text: { type: 'plain_text', text: 'ğŸ”— PR ë³´ê¸°' },\n        url: pr.html_url,\n        style: 'primary'\n      },\n      {\n        type: 'button',\n        text: { type: 'plain_text', text: 'ğŸ“ Files Changed' },\n        url: `${pr.html_url}/files`\n      }\n    ]\n  },\n  {\n    type: 'context',\n    elements: [{\n      type: 'mrkdwn',\n      text: `ğŸ“¦ ${pr.base.repo.full_name} | n8n ìë™í™”`\n    }]\n  }\n);\n\nreturn [{\n  json: {\n    blocks: JSON.stringify(blocks),\n    text: `${actionInfo.icon} ${actionInfo.text}: #${pr.number} ${pr.title} by @${pr.user.login}`\n  }\n}];"
      },
      "id": "format-pr",
      "name": "PR ì •ë³´ í¬ë§·",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [700, 200]
    },
    {
      "parameters": {
        "operation": "post",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "auto-devops",
          "mode": "name"
        },
        "text": "={{ $json.text }}",
        "otherOptions": {
          "includeLinkToWorkflow": false,
          "blocksUi": "={{ $json.blocks }}"
        }
      },
      "id": "slack-send",
      "name": "Slack DevOps ì•Œë¦¼",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.2,
      "position": [950, 200]
    }
  ],
  "connections": {
    "GitHub Webhook": {
      "main": [[{ "node": "PR ì´ë²¤íŠ¸?", "type": "main", "index": 0 }]]
    },
    "PR ì´ë²¤íŠ¸?": {
      "main": [
        [{ "node": "PR ì •ë³´ í¬ë§·", "type": "main", "index": 0 }],
        []
      ]
    },
    "PR ì •ë³´ í¬ë§·": {
      "main": [[{ "node": "Slack DevOps ì•Œë¦¼", "type": "main", "index": 0 }]]
    }
  },
  "settings": { "executionOrder": "v1", "timezone": "Asia/Seoul" }
}
