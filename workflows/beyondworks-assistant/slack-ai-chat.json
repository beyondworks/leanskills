{
  "name": "[ë¹„ì„œ] Slack AI í†µí•© ëŒ€í™”",
  "nodes": [
    {
      "id": "webhook",
      "name": "Slack ë©”ì‹œì§€ ìˆ˜ì‹ ",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [200, 300],
      "webhookId": "schedule-assistant",
      "parameters": {
        "path": "schedule-assistant",
        "httpMethod": "POST",
        "responseMode": "responseNode",
        "options": {}
      }
    },
    {
      "id": "code0",
      "name": "Challenge ì²˜ë¦¬",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [400, 300],
      "parameters": {
        "jsCode": "const body = $input.first().json.body || $input.first().json;\n\n// Slack URL verification challenge\nif (body.type === 'url_verification' && body.challenge) {\n  return [{\n    json: {\n      isChallenge: true,\n      challenge: body.challenge\n    }\n  }];\n}\n\nconst event = body.event || {};\n\n// ë´‡ ë©”ì‹œì§€ í•„í„°ë§\nif (event.bot_id || !event.text) {\n  return [{\n    json: {\n      isChallenge: false,\n      skip: true\n    }\n  }];\n}\n\n// Slack retry í•„í„°ë§\nconst headers = $input.first().json.headers || {};\nif (headers['x-slack-retry-num'] || headers['X-Slack-Retry-Num']) {\n  return [{\n    json: {\n      isChallenge: false,\n      skip: true\n    }\n  }];\n}\n\nreturn [{\n  json: {\n    isChallenge: false,\n    skip: false,\n    message: event.text,\n    channel: event.channel,\n    user: event.user,\n    event_id: body.event_id || ''\n  }\n}];"
      }
    },
    {
      "id": "if1",
      "name": "Challenge í™•ì¸",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [600, 300],
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "condition1",
              "leftValue": "={{ $json.isChallenge }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      }
    },
    {
      "id": "respond1",
      "name": "Challenge ì‘ë‹µ",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [800, 200],
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.challenge }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/plain"
              }
            ]
          }
        }
      }
    },
    {
      "id": "if2",
      "name": "Skip í™•ì¸",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [800, 400],
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "condition2",
              "leftValue": "={{ $json.skip }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      }
    },
    {
      "id": "respond2",
      "name": "ë¹ˆ ì‘ë‹µ",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1000, 500],
      "parameters": {
        "respondWith": "noData",
        "options": {}
      }
    },
    {
      "id": "ssh1",
      "name": "AI ë¹„ì„œ ì‹¤í–‰ (SSH)",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [1000, 300],
      "parameters": {
        "operation": "executeCommand",
        "command": "=python3 /Users/yoogeon/.claude/skills/beyondworks-assistant/assistant.py router \"{{ $json.message.replace(/\"/g, '\\\\\"') }}\" chat {{ $json.user }} {{ $json.channel }} --session-scope universal_v2"
      },
      "credentials": {
        "sshPassword": {
          "id": "cred_ssh_localhost",
          "name": "SSH localhost (Mac)"
        }
      }
    },
    {
      "id": "code2",
      "name": "ì‘ë‹µ íŒŒì‹±",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1200, 300],
      "parameters": {
        "jsCode": "const stdout = $input.first().json.stdout || '{}';\nconst prevData = $('Challenge ì²˜ë¦¬').first().json;\n\nlet response = 'ì‘ë‹µì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';\nlet domain = 'unknown';\ntry {\n  const result = JSON.parse(stdout);\n  response = result.response || response;\n  domain = result.domain || domain;\n} catch (e) {\n  response = 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + e.message;\n}\n\n// ë„ë©”ì¸ ì´ëª¨ì§€ í”„ë¦¬í”½ìŠ¤\nconst domainEmoji = {\n  schedule: 'ğŸ“…', content: 'ğŸ“š', finance: 'ğŸ’°',\n  travel: 'âœˆï¸', tools: 'ğŸ”§', business: 'ğŸ’¼'\n};\nconst prefix = domainEmoji[domain] || 'ğŸ¤–';\n\nreturn [{\n  json: {\n    response: `${prefix} ${response}`,\n    channel: prevData.channel,\n    domain: domain\n  }\n}];"
      }
    },
    {
      "id": "slack1",
      "name": "Slack ì‘ë‹µ ì „ì†¡",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [1400, 300],
      "parameters": {
        "resource": "message",
        "operation": "post",
        "channel": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json.channel }}"
        },
        "text": "={{ $json.response }}",
        "otherOptions": {}
      },
      "credentials": {
        "slackApi": {
          "id": "67xs3j3Zo3E8M20w",
          "name": "Slack account"
        }
      }
    },
    {
      "id": "respond3",
      "name": "ì²˜ë¦¬ ì™„ë£Œ ì‘ë‹µ",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1600, 300],
      "parameters": {
        "respondWith": "noData",
        "options": {}
      }
    }
  ],
  "connections": {
    "Slack ë©”ì‹œì§€ ìˆ˜ì‹ ": {
      "main": [[{"node": "Challenge ì²˜ë¦¬", "type": "main", "index": 0}]]
    },
    "Challenge ì²˜ë¦¬": {
      "main": [[{"node": "Challenge í™•ì¸", "type": "main", "index": 0}]]
    },
    "Challenge í™•ì¸": {
      "main": [
        [{"node": "Challenge ì‘ë‹µ", "type": "main", "index": 0}],
        [{"node": "Skip í™•ì¸", "type": "main", "index": 0}]
      ]
    },
    "Skip í™•ì¸": {
      "main": [
        [{"node": "AI ë¹„ì„œ ì‹¤í–‰ (SSH)", "type": "main", "index": 0}],
        [{"node": "ë¹ˆ ì‘ë‹µ", "type": "main", "index": 0}]
      ]
    },
    "AI ë¹„ì„œ ì‹¤í–‰ (SSH)": {
      "main": [[{"node": "ì‘ë‹µ íŒŒì‹±", "type": "main", "index": 0}]]
    },
    "ì‘ë‹µ íŒŒì‹±": {
      "main": [[{"node": "Slack ì‘ë‹µ ì „ì†¡", "type": "main", "index": 0}]]
    },
    "Slack ì‘ë‹µ ì „ì†¡": {
      "main": [[{"node": "ì²˜ë¦¬ ì™„ë£Œ ì‘ë‹µ", "type": "main", "index": 0}]]
    }
  },
  "settings": {
    "executionOrder": "v1"
  }
}
